# Multi-Target Demo - Routes ConfigMap
#
# This ConfigMap provides per-host token exchange configuration.
# Apply this before the agent deployment so the routes are available.
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: authproxy-routes
  namespace: authbridge
data:
  routes.yaml: |
    # Multi-Target Demo Routes Configuration
    #
    # Each route maps a destination host to token exchange parameters.
    # Order matters - first match wins.

    # Target Alpha - basic token exchange
    - host: "target-alpha-service.authbridge.svc.cluster.local"
      target_audience: "target-alpha"
      token_scopes: "openid target-alpha-aud"

    # Target Beta - basic token exchange
    - host: "target-beta-service.authbridge.svc.cluster.local"
      target_audience: "target-beta"
      token_scopes: "openid target-beta-aud"

    # Target Gamma - basic token exchange
    - host: "target-gamma-service.authbridge.svc.cluster.local"
      target_audience: "target-gamma"
      token_scopes: "openid target-gamma-aud"

    # Also match short service names (within cluster)
    - host: "target-alpha-service"
      target_audience: "target-alpha"
      token_scopes: "openid target-alpha-aud"

    - host: "target-beta-service"
      target_audience: "target-beta"
      token_scopes: "openid target-beta-aud"

    - host: "target-gamma-service"
      target_audience: "target-gamma"
      token_scopes: "openid target-gamma-aud"
